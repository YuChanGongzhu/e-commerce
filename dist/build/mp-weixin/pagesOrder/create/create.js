"use strict";const e=require("../../common/vendor.js"),t=require("../../services/order.js"),r=require("../../stores/modules/address.js");require("../../utils/http.js"),require("../../stores/index.js"),require("../../stores/modules/member.js");const u=e.defineComponent({__name:"create",props:{skuId:null,count:null},setup(u){const s=u,{safeAreaInsets:o}=e.index.getSystemInfoSync(),d=e.ref(""),a=e.ref([{type:1,text:"时间不限 (周一至周日)"},{type:2,text:"工作日送 (周一至周五)"},{type:3,text:"周末配送 (周六至周日)"}]),l=e.ref(0),n=e.computed((()=>a.value[l.value])),i=e=>{l.value=e.detail.value},c=e.ref();e.onLoad((()=>{(async()=>{if(s.count&&s.skuId){const e=await t.getMemberOrderPreNowAPI({skuId:s.skuId,count:s.count});c.value=e.result}else{const e=await t.getMemberOrderPreAPI();c.value=e.result}})()}));const v=e.computed((()=>{var e;return r.useAddressStore().selectedAddress||(null==(e=c.value)?void 0:e.userAddresses.find((e=>e.isDefault)))})),m=async()=>{var r;if(null==(r=v.value)?void 0:r.id){const r=await t.postMemberOrderAPI({addressId:v.value.id,buyerMessage:d.value,deliveryTimeType:n.value.type,goods:c.value.goods.map((e=>({count:Number(e.count),skuId:e.skuId}))),payChannel:2,payType:1});e.index.redirectTo({url:`/pagesOrder/detail/detail?id=${r.result.id}`})}else e.index.showToast({title:"请选择收货地址",icon:"none"})};return(t,r)=>{var u,s,l,p,f,y,g,x;return e.e({a:e.unref(v)},e.unref(v)?{b:e.t(null==(u=e.unref(v))?void 0:u.receiver),c:e.t(e.unref(v).contact),d:e.t(e.unref(v).fullLocation),e:e.t(null==(s=e.unref(v))?void 0:s.address)}:{},{f:e.f(null==(l=c.value)?void 0:l.goods,((t,r,u)=>({a:t.picture,b:e.t(t.name),c:e.t(t.attrsText),d:e.t(t.payPrice),e:e.t(t.price),f:e.t(t.count),g:t.skuId}))),g:"/pages/goods/goods?id=1",h:e.t(e.unref(n).text),i:a.value,j:e.o(i),k:d.value,l:e.o((e=>d.value=e.detail.value)),m:e.t(null==(p=c.value)?void 0:p.summary.totalPrice.toFixed(2)),n:e.t(null==(f=c.value)?void 0:f.summary.postFee.toFixed(2)),o:e.t(null==(y=c.value)?void 0:y.summary.totalPayPrice.toFixed(2)),p:(null==(g=e.unref(v))?void 0:g.id)?"":1,q:e.o(m),r:(null==(x=e.unref(o))?void 0:x.bottom)+"px"})}}});wx.createPage(u);
